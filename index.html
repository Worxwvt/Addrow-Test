<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TestAddrow</title>
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #FFFBE9;
      padding: 30px;
      color: #333;
      font-family: Arial, Helvetica, sans-serif;
    }

    table,
    th,
    td {
      border: 1px solid gray;
      border-collapse: collapse;
      padding: 6px;
    }

    input {
      width: 95%;
    }

    button {
      margin: 2px;
    }

    header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-color: #AD8B73;
    }

    footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      display: flex;
      justify-content: center;
      background-color: #AD8B73;
      align-items: center;
    }

    h2 {
      padding: 20px 0
    }
  </style>
</head <body>

<header>
  <h1>‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á ADDROW ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Base</h1>
</header>
<h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•_ADDROW</h2>

<table id="employeeTable">
  <thead>
    <tr>
      <th>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
      <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
      <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<br>
<button onclick="addRow()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß</button>

<script type="module">
  // üöÄ Firebase SDK
  import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {getFirestore, collection, addDoc, getDocs, deleteDoc, doc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // üîßFirebase config
  const firebaseConfig = {
    apiKey: "AIzaSyB4L6C9c752cpbN8dzjDP303NMYr2Mlo80",
    authDomain: "testaddrow-5681c.firebaseapp.com",
    projectId: "testaddrow-5681c",
    storageBucket: "testaddrow-5681c.firebasestorage.app",
    messagingSenderId: "892145788614",
    appId: "1:892145788614:web:223c8dd4725a33a1b959c7",
    measurementId: "G-9BVM0Q4G2Z"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const empCol = collection(db, "employees");

  // üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
  async function loadData() {
    const snapshot = await getDocs(empCol);
    document.getElementById("tableBody").innerHTML = "";

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      renderRow(data.empId, data.name, data.position, docSnap.id);
    });
  }

  // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
  function renderRow(empId = "", name = "", position = "", docId = null) {
    const row = document.createElement("tr");

    row.innerHTML = `
        <td><input type="text" class="empIdInput" value="${empId}" ${docId ? "readonly" : ""}></td>
        <td><input type="text" class="nameInput" value="${name}" ${docId ? "readonly" : ""}></td>
        <td><input type="text" class="positionInput" value="${position}" ${docId ? "readonly" : ""}></td>
        <td>
          ${docId ?
        `<button onclick="deleteFromFirebase('${docId}', this)">üóëÔ∏è ‡∏•‡∏ö</button>` :
        `<button onclick="saveToFirebase(this)">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
             <button onclick="deleteTempRow(this)">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>`
      }
        </td>
      `;

    document.getElementById("tableBody").appendChild(row);
  }

  // ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÄ‡∏õ‡∏•‡πà‡∏≤ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)
  window.addRow = function () {
    renderRow();
  }

  // üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
  window.saveToFirebase = async function (btn) {
    const row = btn.closest("tr");
    const empId = row.querySelector(".empIdInput").value.trim();
    const name = row.querySelector(".nameInput").value.trim();
    const position = row.querySelector(".positionInput").value.trim();

    if (!empId || !name || !position) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á");
      return;
    }

    try {
      const docRef = await addDoc(empCol, {
        empId,
        name,
        position,
        createdAt: new Date()
      });

      alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ß readonly)
      loadData();
    } catch (err) {
      console.error("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
    }
  }

  // üóëÔ∏è ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase
  window.deleteFromFirebase = async function (docId, btn) {
    if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?")) return;

    try {
      await deleteDoc(doc(db, "employees", docId));
      btn.closest("tr").remove();
      alert("‚úÖ ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    } catch (err) {
      console.error("‚ùå ‡∏•‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
    }
  }

  // ‚ùå ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  window.deleteTempRow = function (btn) {
    btn.closest("tr").remove();
  }

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  loadData();
</script>

<footer>
  <p>Copyright 2025 By Worawut Aiam-art</p>
</footer>
</body>

</html>
